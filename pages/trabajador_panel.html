<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel Trabajador - MINEBYTE</title>
  <link rel="stylesheet" href="../css/index.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <script>
    const API_BASE_URL = 'http://localhost/minas_project/php';
    const SITE_BASE_URL = 'http://localhost/minas_project';
  </script>
</head>
<body>
  <div class="contenedor">
    <!-- Barra lateral -->
    <aside class="barra-lateral">
      <div class="logo">
        <div class="logo-icono">
          <img src="../Logo bodrio.png" alt="MINEBYTE">
        </div>
        <h2>MINEBYTE</h2>
      </div>
      <nav>
        <a href="trabajador_panel.html" class="nav-link active">
          <i class="fas fa-tachometer-alt"></i>
          <span>Panel</span>
        </a>
        <a href="sensores.html" class="nav-link">
          <i class="fas fa-microchip"></i>
          <span>Sensores</span>
        </a>
        <a href="alertas.html" class="nav-link">
          <i class="fas fa-exclamation-triangle"></i>
          <span>Alertas</span>
        </a>
        <a href="acciones.html" class="nav-link">
          <i class="fas fa-tasks"></i>
          <span>Mis Acciones</span>
        </a>
        <a href="cuenta.html" class="nav-link">
          <i class="fas fa-user-cog"></i>
          <span>Cuenta</span>
        </a>
      </nav>
      <div class="usuario-info">
        <div class="avatar-mini">
          <span>RG</span>
        </div>
        <div class="usuario-datos">
          <p class="usuario-nombre">Roberto García</p>
          <p class="usuario-rol">Trabajador</p>
        </div>
      </div>
    </aside>

    <!-- Contenido principal -->
    <main class="contenido-principal">
      <header>
        <div class="header-titulo">
          <h1>Panel de Trabajador</h1>
          <p class="fecha" id="fecha-actual">Cargando fecha...</p>
        </div>
        <div class="header-acciones">
          <button class="btn btn-secundario" onclick="actualizarPanel()">
            <i class="fas fa-sync-alt"></i>
            Actualizar
          </button>
          <button class="btn btn-primario" onclick="reportarIncidencia()">
            <i class="fas fa-exclamation-circle"></i>
            Reportar Incidencia
          </button>
        </div>
      </header>

      <!-- Estado actual de la mina -->
      <section class="estado-mina">
        <div class="tarjeta estado-general">
          <div class="estado-header">
            <h2>Estado Actual - Mina El Dorado</h2>
            <div class="estado-indicador">
              <span class="estado-normal">Condiciones Normales</span>
            </div>
          </div>
          <div class="estado-detalles">
            <div class="detalle-item">
              <i class="fas fa-hard-hat"></i>
              <div>
                <h4>Turno Actual</h4>
                <p>Matutino (6:00 - 14:00)</p>
              </div>
            </div>
            <div class="detalle-item">
              <i class="fas fa-user-friends"></i>
              <div>
                <h4>Personal en Mina</h4>
                <p>24 trabajadores</p>
              </div>
            </div>
            <div class="detalle-item">
              <i class="fas fa-clock"></i>
              <div>
                <h4>Horas de Operación</h4>
                <p>8:45 horas</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Alertas activas -->
      <div class="seccion-titulo">
        <h2>Alertas Activas en Mi Área</h2>
      </div>
      
      <section class="alertas-area" id="alertas-area">
        <div class="tarjeta sin-alertas">
          <div class="alerta-contenido">
            <i class="fas fa-check-circle"></i>
            <h3>No hay alertas activas en tu área</h3>
            <p>Todas las condiciones se encuentran dentro de los parámetros normales de seguridad.</p>
          </div>
        </div>
      </section>

      <!-- Sensores de mi área -->
      <div class="seccion-titulo">
        <h2>Sensores de Mi Área</h2>
      </div>
      
      <section class="tarjetas" id="tarjetas-sensores">
        <!-- Los sensores se cargarán dinámicamente -->
      </section>

      <!-- Mis acciones asignadas -->
      <div class="seccion-titulo">
        <h2>Mis Acciones Asignadas</h2>
        <button class="btn btn-texto" onclick="window.location.href='acciones.html'">
          Ver todas <i class="fas fa-arrow-right"></i>
        </button>
      </div>
      
      <section class="tabla-contenedor">
        <table class="tabla">
          <thead>
            <tr>
              <th>ID</th>
              <th>Descripción</th>
              <th>Prioridad</th>
              <th>Estado</th>
              <th>Fecha límite</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="tabla-mis-acciones-body">
            <!-- Las acciones se cargarán dinámicamente -->
          </tbody>
        </table>
      </section>
    </main>
  </div>

  <script src="../app.js"></script>
  <script>
    function actualizarPanel() {
      cargarSensoresArea();
      cargarMisAcciones();
      mostrarMensaje('Panel actualizado correctamente', 'exito');
    }

    function reportarIncidencia() {
      const descripcion = prompt('Describe la incidencia:');
      if (descripcion) {
        mostrarMensaje('Incidencia reportada correctamente', 'exito');
        // Aquí se enviaría la información al servidor
      }
    }

    function cargarSensoresArea() {
      // Simular datos de sensores del área del trabajador
      const sensores = [
        { tipo: 'temperatura', valor: '24.5°C', estado: 'normal', ubicacion: 'Sector B - Nivel 3' },
        { tipo: 'humedad', valor: '68%', estado: 'normal', ubicacion: 'Sector B - Nivel 3' },
        { tipo: 'gas', valor: '85 ppm', estado: 'alerta', ubicacion: 'Sector B - Nivel 3' },
        { tipo: 'vibracion', valor: '2.1 m/s²', estado: 'normal', ubicacion: 'Sector B - Nivel 3' }
      ];

      const contenedor = document.getElementById('tarjetas-sensores');
      if (contenedor) {
        contenedor.innerHTML = sensores.map(sensor => `
          <div class="tarjeta sensor ${sensor.tipo}">
            <div class="sensor-icono">
              <i class="fas fa-${sensor.tipo === 'temperatura' ? 'thermometer-half' : 
                                sensor.tipo === 'humedad' ? 'tint' : 
                                sensor.tipo === 'gas' ? 'wind' : 'wave-square'}"></i>
            </div>
            <div class="sensor-contenido">
              <h3>Sensor de ${sensor.tipo.charAt(0).toUpperCase() + sensor.tipo.slice(1)}</h3>
              <p class="sensor-valor">${sensor.valor}</p>
              <p class="sensor-ubicacion">${sensor.ubicacion}</p>
              <div class="sensor-estado">
                <span class="estado-${sensor.estado}">${sensor.estado.charAt(0).toUpperCase() + sensor.estado.slice(1)}</span>
              </div>
            </div>
          </div>
        `).join('');
      }
    }

    function cargarMisAcciones() {
      const acciones = [
        { id: 'AC-015', descripcion: 'Revisar sistema de ventilación - Sector B', prioridad: 'Alta', estado: 'Pendiente', fecha: '15/11/2025' },
        { id: 'AC-019', descripcion: 'Inspección rutinaria de equipos', prioridad: 'Media', estado: 'En Progreso', fecha: '12/11/2025' },
        { id: 'AC-021', descripcion: 'Limpieza de filtros de aire', prioridad: 'Baja', estado: 'Completada', fecha: '10/11/2025' }
      ];

      const tbody = document.getElementById('tabla-mis-acciones-body');
      if (tbody) {
        tbody.innerHTML = acciones.map(accion => `
          <tr>
            <td>${accion.id}</td>
            <td>${accion.descripcion}</td>
            <td><span class="prioridad-${accion.prioridad.toLowerCase()}">${accion.prioridad}</span></td>
            <td><span class="estado-${accion.estado.toLowerCase().replace(' ', '-')}">${accion.estado}</span></td>
            <td>${accion.fecha}</td>
            <td>
              <button class="btn btn-texto" onclick="verAccion('${accion.id}')">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn btn-texto" onclick="actualizarEstadoAccion('${accion.id}')">
                <i class="fas fa-edit"></i>
              </button>
            </td>
          </tr>
        `).join('');
      }
    }

    function verAccion(id) {
      alert(`Ver acción ${id} - Funcionalidad en desarrollo`);
    }

    function actualizarEstadoAccion(id) {
      const nuevoEstado = prompt('Actualizar estado (Pendiente/En Progreso/Completada):');
      if (nuevoEstado) {
        mostrarMensaje(`Estado de la acción ${id} actualizado a: ${nuevoEstado}`, 'exito');
        cargarMisAcciones(); // Recargar para reflejar cambios
      }
    }

    function mostrarMensaje(mensaje, tipo) {
      // Implementación básica de mensajes
      alert(mensaje);
    }

    // Inicializar página específica del panel
    document.addEventListener('DOMContentLoaded', function() {
      // Establecer fecha actual
      const fecha = new Date();
      document.getElementById('fecha-actual').textContent = fecha.toLocaleDateString('es-ES', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });

      cargarSensoresArea();
      cargarMisAcciones();
    });
  </script>
</body>
</html>